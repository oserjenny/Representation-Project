---
title: "Data cleaning"
author: "Jenny"
date: "January 2019"
output:
  pdf_document: default
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readr)
library(tidyverse)
library(knitr)
library(haven)
```

## Introduction

This file documents the data cleaning for the Representation Project

## Data cleaning - Cumulative

Read in the data.
```{r}
tbl <- read_rds("../Data/cumulative_2006_2017.Rds")
```

Take a look at the data
```{r} 
head(tbl)
```

Another way to look at the data, where we can clearly see all variable names and types.
```{r} 
tbl %>% glimpse()
```

Select variables (from Kuriwaki Guide)
```{r}
tbl %>%
  select(year, case_id, pid3)
```


Display frequencies of validated turnout General Election over time - shows only first few rows in console
```{r} 
tbl %>% 
  group_by(year) %>% 
  count(vv_turnout_gvm)
```

Display frequencies of validated turnout General Election over time - shows all rows in console in `kable` format to print in a clean formatted table.
```{r} 
tbl %>% 
  group_by(year) %>% 
  count(vv_turnout_gvm) %>% 
  kable()
```

Recode of vv_turnout_gvm to dichotomous
```{r} 
tbl <- tbl %>%
  mutate(vv_turnout_gvm_binary = as.numeric(vv_turnout_gvm == "Voted"))
```

Display frequencies of recoded Validated turnout General Election over time 
```{r} 
tbl %>% 
  group_by(year) %>% 
  count(vv_turnout_gvm_binary)
```

Display table, frequencies of recoded Validated turnout General Election over time 
```{r} 
tbl %>% 
  group_by(year) %>% 
  count(vv_turnout_gvm_binary) %>% 
  kable(align = c("l", "c", "c"))
```


## Descriptive Statistics

Year:
```{r} 
tbl %>% 
  count(year) 
```

tookpost - "Whether or not the respondent took the post-election wave of the survey (in even years)"
```{r} 
tbl %>% 
  group_by(year) %>% 
  count(tookpost) %>% 
  filter(!is.na(tookpost)) %>% 
  mutate(percent = round((n / sum(n)) * 100, 2))
```

Weight - year-specific for all years, see Kuriwaki p.7 for notes
```{r} 
tbl %>% 
  group_by(year) %>% 
  summarize(mean = mean(weight, na.rm = TRUE),
            sd   = sd(weight, na.rm = TRUE),
            min  = min(weight),
            max  = max(weight)
  )
```

Weight - cumulative. Includes simple adjustment of multiplying a constant within year to make years comparable.
```{r} 
tbl %>% 
  group_by(year) %>% 
  summarize(mean = mean(weight_cumulative, na.rm = TRUE),
            sd   = sd(weight_cumulative, na.rm = TRUE),
            min  = min(weight_cumulative),
            max  = max(weight_cumulative)
  )
```

Geographic variables
*state - imputed from input zipcode
*st - same data as "State", Var name = 2-letter State abbreviation
```{r} 
tbl %>% 
  count(state, st) 
```


Geographic variables
*cd: Congressional district in current Congress
```{r} 
tbl %>% 
  count(st, cd) 
```

Gender
```{r} 
tbl %>% 
  count(gender) 
```

Age
```{r} 
tbl %>% 
  summarize(mean = mean(age),
            sd   = sd(age),
            min  = min(age),
            max  = max(age)
  ) %>% 
  mutate(variable = "age") %>% 
  select(variable, everything())
```

## Figures

Plot turnout dichotomous by year via bar charts:

```{r} 

# counts
tbl %>% 
  filter(year %% 2 != 1) %>%        # filter to even years
  mutate(year = as.character(year)) %>% 
  ggplot(aes(x = year, y = vv_turnout_gvm_binary, colour = year)) +
  geom_bar(stat = "identity") +
  labs(x = "Year", y = "Voter Turnout", title = "Voter Turnout by Year") +
  theme(legend.position = "none")

# percent
tbl %>% 
  filter(year %% 2 != 1) %>%        # filter to even years
  mutate(year = as.character(year)) %>% 
  group_by(year) %>% 
  summarize(percent = mean(vv_turnout_gvm_binary, na.omit = TRUE) * 100) %>% 
  ggplot(aes(x = year, y = percent, fill = year)) +
  geom_bar(stat = "identity") +
  labs(x = "Year", y = "Percent Voter Turnout", title = "Percent Voter Turnout by Year") +
  theme(legend.position = "none")
```

Plot turnout dichotomous by year via line plots:

```{r}

# counts
tbl %>% 
  group_by(year) %>% 
  count(vv_turnout_gvm_binary) %>% 
  filter(vv_turnout_gvm_binary == 1) %>% 
  ggplot(aes(x = year, y = n)) +
  geom_line() +
  geom_point() +
  ylim(0, 50000) +
  labs(x = "Year", y = "Voter Turnout", title = "Voter Turnout by Year")

# percents
tbl %>% 
  filter(year %% 2 != 1) %>%        # filter to even years
  mutate(year = as.character(year)) %>% 
  group_by(year) %>% 
  summarize(percent = mean(vv_turnout_gvm_binary, na.omit = TRUE) * 100) %>% 
  ungroup() %>% 
  ggplot(aes(x = year, y = percent, group = 1)) +
  geom_point() +
  geom_line() +
  ylim(0, 100) +
  labs(x = "Year", y = "Percent Voter Turnout", title = "Percent Voter Turnout by Year")
```



## Data cleaning - 2012, replicating Perspectives findings with focus on Independents

JO dropbox link to Nov 2018 work on this topic in stata:
CCES 2012_Russ Sage: https://www.dropbox.com/sh/fc7cn2fmaxocsyu/AADt5fFQ9jFXUQgcW65pVYvRa?dl=0

Read in 2012 cleaned data for Perspectives paper.
```{r}

tbl2012 <- read_dta("../Data/CCES_foranalysis.dta")
```

Examine the variables we are interested in.

```{r}

tbl2012 %>% 
  select(healthcarerepeal1_House1,
         ryanbudget_House1,
         koreafreetrade_House1,
         simpsonbowles_House1,
         keystonepipeline_House1,
         dontaskdonttell_House1) %>% 
  glimpse()  
```

Some descriptive statistics.

```{r}

tbl2012_vars <- tbl2012 %>% 
  select(healthcarerepeal1_House1,
         ryanbudget_House1,
         koreafreetrade_House1,
         simpsonbowles_House1,
         keystonepipeline_House1,
         dontaskdonttell_House1) %>% 
  colnames()

tbl2012_vars %>% 
  map(~ tbl2012 %>%
        count(!!sym(.x)) %>%
        mutate(percent = round((n / sum(n)) * 100, 2)))

# counts of healthcare repeal votes in the House grouped by state district and party
tbl2012 %>% 
  group_by(st_dist, party_House1) %>% 
  count(healthcarerepeal1_House1)
```

These are pretty messy, let's recode them.
```{r}

tbl2012 <- tbl2012 %>% 
  mutate_at(tbl2012_vars, list(~ na_if(., y = ""))) %>% 
  mutate(
    healthcarerepeal1_House1 = case_when(
      healthcarerepeal1_House1 == "For"     ~ "For",
      healthcarerepeal1_House1 == "Against" ~ "Against",
      TRUE ~ NA_character_
    ),
    ryanbudget_House1 = case_when(
      ryanbudget_House1 == "For"     ~ "For",
      ryanbudget_House1 == "Against" ~ "Against",
      TRUE ~ NA_character_
    ),
    koreafreetrade_House1 = case_when(
      koreafreetrade_House1 == "For"     ~ "For",
      koreafreetrade_House1 == "Against" ~ "Against",
      TRUE ~ NA_character_
    ),
    simpsonbowles_House1 = case_when(
      simpsonbowles_House1 == "For"     ~ "For",
      simpsonbowles_House1 == "Against" ~ "Against",
      TRUE ~ NA_character_
    ),
    keystonepipeline_House1 = case_when(
      keystonepipeline_House1 == "For"     ~ "For",
      keystonepipeline_House1 == "Against" ~ "Against",
      TRUE ~ NA_character_
    ),
    dontaskdonttell_House1 = case_when(
      dontaskdonttell_House1 == "Announced For"     ~ "For",
      dontaskdonttell_House1 == "Announced Against" ~ "Against",
      dontaskdonttell_House1 == "Yea"     ~ "For",
      dontaskdonttell_House1 == "Nay" ~ "Against",
      TRUE ~ NA_character_
    )
  )

# check recodes
tbl2012_vars %>% 
  map(~ tbl2012 %>%
        count(!!sym(.x)) %>%
        mutate(percent = round((n / sum(n)) * 100, 2)))                                         
```  


## Data cleaning - Panel 2010-2012-2014

Panel data and Guide downloaded 1Feb2019: https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/TOE8I1]

As reminder of prior work, link to prior panel data analyses in stata:
CCES panel 2010-2012-2014: https://www.dropbox.com/sh/gj4vfv9xzvdgkwd/AABpmEqKQBT6EQDVCFvqeV7Ka?dl=0

I. Cleaning respondent data

Read in the data.
```{r}

tbl_panel <- haven::read_dta("../Data/CCES_Panel_Full3waves_VV_V4.dta", encoding = "latin1")
```


Recode of relevant respondent measures
Begin with 1 indicator as example:
CC10_330A = Roll Call, American Recovery and Reinvestment Act
```{r}

tbl_panel %>% 
  count(CC10_330A) 
```

See head of dataset in in console
```{r}

head(tbl_panel)
```

View 1st 6 rows of data for all vars as dataset
JO NOTE: I'm aware this command causes problems with Rmarkdown, but I'm retaining it during this preliminary data cleaning phase because it is important to view the stata meta-data that describe each variable but does not get reported in R (see e.g. 3rd column "CC10_301_1" is labeled underneath the variable name "Media use - Blog 2010"). This information is important to reference during data cleaning for this dataset because the pdf Guide does not always correctly document the variables that are actually in the data.
```{r, eval=FALSE}

head(tbl_panel) %>% View
```

Recode CC10_330A as factor - converts the labeled numeric column into a factor with strings as the values.
```{r}

tbl_panel <- tbl_panel %>% 
    mutate(CC10_330A_fac = as_factor(CC10_330A))

# check successful mutate
tbl_panel %>% 
  count(CC10_330A, CC10_330A_fac)
```

Count all 2010 vars noted in pdf Guide to verify they're in dataset (p.49 of Guide)
```{r}

CC10_330_vars <- tbl_panel %>% 
  select(CC10_330B, CC10_330C, CC10_330D, CC10_330E,
         CC10_330F, CC10_330G, CC10_330H, CC10_330I, CC10_330J) %>% 
  colnames() 

CC10_330_vars %>% 
  map(~ tbl_panel %>% count(!!sym(.x)))
```


Recode all remaining 2010 vars as factor
```{r}

tbl_panel <- tbl_panel %>% 
  mutate_at(vars(CC10_330B, CC10_330C, CC10_330D, CC10_330E,
                 CC10_330F, CC10_330G, CC10_330H, CC10_330I, CC10_330J), 
            funs(fac = as_factor(.)))
```


Confirm that mutate performed correctly
```{r}

fac_vars <- CC10_330_vars %>% 
  paste0("_fac")

map2(CC10_330_vars, fac_vars, ~ tbl_panel %>% count(!!sym(.x), !!sym(.y)))
```


2012: Count all 2012 vars noted in pdf Guide to verify they're in dataset (p. 143 of Guide)
```{r}

CC12_vars <- tbl_panel %>% 
  select(CC12_330A, CC12_330B, CC12_330C, CC12_330D, CC12_330E,
         CC12_330F, CC12_330G, CC12_330H, CC12_332A, CC12_332B,
         CC12_332C, CC12_332D, CC12_332E, CC12_332F) %>% 
  colnames() 

CC12_vars %>% 
  map(~ tbl_panel %>% count(!!sym(.x)))
```

Note: the final 2 vars in the list in the Guide don't appear in the data:
CC12_332G = Repeal ACA
CC12_332H = Keystone 


Recode all 2012 roll call votes as factors
```{r}

tbl_panel <- tbl_panel %>% 
  mutate_at(vars(CC12_330A, CC12_330B, CC12_330C, CC12_330D, CC12_330E,
                 CC12_330F, CC12_330G, CC12_330H, CC12_332A, CC12_332B,
                 CC12_332C, CC12_332D, CC12_332E, CC12_332F), 
            funs(fac = as_factor(.)))

# Confirm that mutate performed correctly
CC12_fac_vars <- CC12_vars %>% 
  paste0("_fac")

map2(CC12_vars, CC12_fac_vars, ~ tbl_panel %>% count(!!sym(.x), !!sym(.y)))
```

Count all 2014 vars noted in pdf Guide to verify they're in dataset (p. 269ff of Guide)
```{r}

CC14_vars <- tbl_panel %>% 
  select(CC14_330A, CC14_330B, CC14_330C, CC14_330D, CC14_330E,
         CC14_330F, CC14_330G, CC14_330H, CC14_332A, CC14_332B,
         CC14_332C, CC14_332D, CC14_332E, CC14_332F) %>% 
  colnames() 

CC14_vars %>% 
  map(~ tbl_panel %>% count(!!sym(.x)))
```

Recode all 2014 roll call votes as factors
```{r}

tbl_panel <- tbl_panel %>% 
  mutate_at(vars(CC14_330A, CC14_330B, CC14_330C, CC14_330D, CC14_330E,
                 CC14_330F, CC14_330G, CC14_330H, CC14_332A, CC14_332B,
                 CC14_332C, CC14_332D, CC14_332E, CC14_332F), 
            funs(fac = as_factor(.)))

# Confirm that mutate performed correctly
CC14_fac_vars <- CC14_vars %>% 
  paste0("_fac")

map2(CC14_vars, CC14_fac_vars, ~ tbl_panel %>% count(!!sym(.x), !!sym(.y)))
```


## Recode Voting Participation 

Validated vote variables, general election: `VV_general_10`, `VV_general_12`, `VV_general_14`

Recode as factor and binary variables .

```{r}

voting_vars <- c("VV_general_10", "VV_general_12", "VV_general_14")

tbl_panel <- tbl_panel %>% 
  mutate_at(voting_vars, funs(fac = as_factor(.))) %>% 
  mutate_at(voting_vars, funs(bin = case_when(
    . %in% c(1, 2, 3, 4, 5) ~ "vote",
    . == 6                  ~ "not vote",
    . == 9                  ~ NA_character_
  )))

# check recodes
voting_fac_vars <- voting_vars %>% 
  paste0("_fac")

voting_bin_vars <- voting_vars %>% 
  paste0("_bin")

pmap(list(voting_bin_vars, voting_fac_vars, voting_vars),
     ~ tbl_panel %>% count(!!sym(..1), !!sym(..2), !!sym(..3)))
```


## Recode Political Participation

#### Attend meetings

Political activity: Attend meetings 2010
During the past year did you...Attend local political meetings (such as school board or city council)

Variables: `CC10_417a_1`, `CC12_417a_1`, `CC14_417a_1`

Recode all as binary factors.

```{r}

attend_meeting_vars <- c("CC10_417a_1", "CC12_417a_1", "CC14_417a_1")

tbl_panel <- tbl_panel %>% 
  mutate_at(attend_meeting_vars, funs(fac = as_factor(.)))

# Confirm that mutate performed correctly
attend_meeting_fac_vars <- attend_meeting_vars %>% 
  paste0("_fac")

map2(attend_meeting_vars, attend_meeting_fac_vars,
     ~ tbl_panel %>% count(!!sym(.x), !!sym(.y)))
```

Figures:

```{r}

attend_meeting_plot_tbl <- map2_df(attend_meeting_vars, attend_meeting_fac_vars,
                                   ~ tbl_panel %>%
                                     count(!!sym(.x), !!sym(.y)) %>% 
                                     select(contains("_fac"), n) %>%
                                     mutate(year = .x) %>%
                                     rename(attend_meeting = .y) %>% 
                                     select(year, attend_meeting, n)) %>% 
  mutate(year = case_when(
    year == "CC10_417a_1" ~ "2010",
    year == "CC12_417a_1" ~ "2012",
    year == "CC14_417a_1" ~ "2014"
  )) %>% 
  group_by(year) %>% 
  mutate(percent = round((n / sum(n)) * 100, 1)) %>% 
  ungroup() %>% 
  filter(attend_meeting == "Yes")

attend_meeting_plot_tbl %>% 
  knitr::kable()
  
# bar chart
attend_meeting_plot_tbl %>% 
  ggplot(aes(x = year, y = percent, fill = year)) +
  geom_bar(stat = "identity") +
  geom_text(aes(y = percent + 1.5,    # nudge above top of bar
                  label = paste0(percent, '%')),    # prettify
              position = position_dodge(width = .9), 
              size = 4) +
  lims(y = c(0, 50)) +
  labs(x     = "Year",
       y     = "Percent",
       title = "Percent Attending Local Political Meetings by Year") +
  theme(legend.position = "none")
```


####  Political sign 

During the past year did you...Put up a political sign (such as a lawn sign or bumper sticker)?

Variables: `CC10_417a_2`, `CC12_417a_2`, `CC14_417a_2`

Recode all as binary factors.

```{r}

pol_sign_vars <- c("CC10_417a_2", "CC12_417a_2", "CC14_417a_2")

tbl_panel <- tbl_panel %>% 
  mutate_at(pol_sign_vars, funs(fac = as_factor(.)))

# Confirm that mutate performed correctly
pol_sign_fac_vars <- pol_sign_vars %>% 
  paste0("_fac")

map2(pol_sign_vars, pol_sign_fac_vars,
     ~ tbl_panel %>% count(!!sym(.x), !!sym(.y)))
```

Figure:

```{r}

pol_sign_plot_tbl <- map2_df(pol_sign_vars, pol_sign_fac_vars,
                             ~ tbl_panel %>%
                               count(!!sym(.x), !!sym(.y)) %>% 
                               select(contains("_fac"), n) %>%
                               mutate(year = .x) %>%
                               rename(political_sign = .y) %>% 
                               select(year, political_sign, n)) %>% 
  mutate(year = case_when(
    year == "CC10_417a_2" ~ "2010",
    year == "CC12_417a_2" ~ "2012",
    year == "CC14_417a_2" ~ "2014"
  )) %>% 
  group_by(year) %>% 
  mutate(percent = round((n / sum(n)) * 100, 1)) %>% 
  ungroup() %>% 
  filter(political_sign == "Yes")

pol_sign_plot_tbl %>% 
  knitr::kable()
  
# bar chart
pol_sign_plot_tbl %>% 
  ggplot(aes(x = year, y = percent, fill = year)) +
  geom_bar(stat = "identity") +
  geom_text(aes(y = percent + 1.5,    # nudge above top of bar
                  label = paste0(percent, '%')),    # prettify
              position = position_dodge(width = .9), 
              size = 4) +
  lims(y = c(0, 50)) +
  labs(x     = "Year",
       y     = "Percent",
       title = "Percent Who Put Up a Political Sign by Year") +
  theme(legend.position = "none")
```

#### "Work for campaign"

During the past year did you...Work for a candidate or campaign?

Variables: `CC10_417a_3`, `CC12_417a_3`, `CC14_417a_3`

Recode all as binary factors.

```{r}

work_campaign_vars <- c("CC10_417a_3", "CC12_417a_3", "CC14_417a_3")

tbl_panel <- tbl_panel %>% 
  mutate_at(work_campaign_vars, funs(fac = as_factor(.)))

# Confirm that mutate performed correctly
work_campaign_fac_vars <- work_campaign_vars %>% 
  paste0("_fac")

map2(work_campaign_vars, work_campaign_fac_vars,
     ~ tbl_panel %>% count(!!sym(.x), !!sym(.y)))
```

Figure:

```{r}

work_campaign_plot_tbl <- map2_df(work_campaign_vars, work_campaign_fac_vars,
                                  ~ tbl_panel %>%
                                    count(!!sym(.x), !!sym(.y)) %>% 
                                    select(contains("_fac"), n) %>%
                                    mutate(year = .x) %>%
                                    rename(work_campaign = .y) %>% 
                                    select(year, work_campaign, n)) %>% 
  mutate(year = case_when(
    year == "CC10_417a_3" ~ "2010",
    year == "CC12_417a_3" ~ "2012",
    year == "CC14_417a_3" ~ "2014"
  )) %>% 
  group_by(year) %>% 
  mutate(percent = round((n / sum(n)) * 100, 1)) %>% 
  ungroup() %>% 
  filter(work_campaign == "Yes")

work_campaign_plot_tbl %>% 
  knitr::kable()
  
# bar chart
work_campaign_plot_tbl %>% 
  ggplot(aes(x = year, y = percent, fill = year)) +
  geom_bar(stat = "identity") +
  geom_text(aes(y = percent + 1.5,    # nudge above top of bar
                  label = paste0(percent, '%')),    # prettify
              position = position_dodge(width = .9), 
              size = 4) +
  lims(y = c(0, 50)) +
  labs(x     = "Year",
       y     = "Percent",
       title = "Percent Who Worked for a Campaign by Year") +
  theme(legend.position = "none")
```


#### "Donate money"

During the past year did you...Donate money to a candidate, campaign, or political organization?

Variables: `CC10_417a_4`, `CC12_417a_4`, `CC14_417a_4` 

```{r}

donate_vars <- c("CC10_417a_4", "CC12_417a_4", "CC14_417a_4")

tbl_panel <- tbl_panel %>% 
  mutate_at(donate_vars, funs(fac = as_factor(.)))

# Confirm that mutate performed correctly
donate_fac_vars <- donate_vars %>% 
  paste0("_fac")

map2(donate_vars, donate_fac_vars,
     ~ tbl_panel %>% count(!!sym(.x), !!sym(.y)))
```

Figure:

```{r}

donate_plot_tbl <- map2_df(donate_vars, donate_fac_vars,
                           ~ tbl_panel %>%
                             count(!!sym(.x), !!sym(.y)) %>% 
                             select(contains("_fac"), n) %>%
                             mutate(year = .x) %>%
                             rename(donate_money = .y) %>% 
                             select(year, donate_money, n)) %>% 
  mutate(year = case_when(
    year == "CC10_417a_4" ~ "2010",
    year == "CC12_417a_4" ~ "2012",
    year == "CC14_417a_4" ~ "2014"
  )) %>% 
  group_by(year) %>% 
  mutate(percent = round((n / sum(n)) * 100, 1)) %>% 
  ungroup() %>% 
  filter(donate_money == "Yes")

donate_plot_tbl %>% 
  knitr::kable()
  
# bar chart
donate_plot_tbl %>% 
  ggplot(aes(x = year, y = percent, fill = year)) +
  geom_bar(stat = "identity") +
  geom_text(aes(y = percent + 1.5,    # nudge above top of bar
                  label = paste0(percent, '%')),    # prettify
              position = position_dodge(width = .9), 
              size = 4) +
  lims(y = c(0, 50)) +
  labs(x     = "Year",
       y     = "Percent",
       title = "Percent Who Donated Money to a Candidate, Campaign, or Political Organization by Year") +
  theme(legend.position = "none")
```


## Merge available coded roll call votes
NOTE: 2010 exists in CCES dataverse, but only codes Congressional candidates by race and ethnicity variables.

2012 relevant folder in github: "CCES 2012 supplemental"


II. Create joined data file (respondents & roll call votes)
In stata: Reshaped into wide format to join
In R, relevant commands: spread, gather, mutate_at

Can reference prior stata work for joining procedure using stata:
CCES panel 2010-2012-2014: https://www.dropbox.com/sh/gj4vfv9xzvdgkwd/AABpmEqKQBT6EQDVCFvqeV7Ka?dl=0

**NOTE: for 2012, CCES has two versions of roll call vote data, and I can't tell which one is the correct to use for merge:

1st: This is version we used in prior 2012 stata work, and this is the one referenced by Brian Schaffner in correspondence re: available roll call data. JA did significant recodes to get it to work. In github, this documentation is in folder "CCES 2010 supplemental"
Cuevas-Molina, Ivelisse; Schaffner, Brian, 2015, "CCES 2014 Supplemental Data", https://doi.org/10.7910/DVN/D1N0GO, Harvard Dataverse, V3, UNF:6:M0Py+4hUexjh8WSlUevvDQ== [fileUNF]

2nd: I came across this next source randomly - it has an earlier publication date, so I wonder if there is a reason why they have two separate codings available, and why we used the 1st version in our prior work, and not this one. In github it's in the folder "CCES 2012 roll call votes_Pettigrew"
Pettigrew, Stephen, 2013, "Roll Call Votes - 112th Congress- 2012 CCES", https://hdl.handle.net/1902.1/20540, Harvard Dataverse, V3


Link for CCES 2014 supplemental data:
https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/D1N0GO 


## Recode Socio-Dem Data
Socio-dem data - code below is a start
```{r}

tbl_panel %>% 
  select(gender_10, birthyr_10) %>% 
  mutate(gender = as_factor(gender_10),
         age    = 2010 - birthyr_10)
```
